<!DOCTYPE html>
<html lang="en">

  <head>
    <link rel="stylesheet" href="styling.css" />
    <style>
      label {
        display: inline-block;
        text-align: right;
      }
    </style>
    <meta charset="UTF-8">
    <title>To-dos</title>
    

  </head> 

  <script type="text/javascript">
    const PORT = 8080;
    const HOST = "192.168.31.86";
    function createProject() {
      var xhr = new XMLHttpRequest();
      xhr.open('POST', `http://${HOST}:${PORT}/create/project`);
      let json = JSON.stringify({
        name: document.getElementById("projectName").value,
      });
      xhr.responseType = 'json';
      xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
      xhr.send(json);

      xhr.onload = function() {
        let responseObj = xhr.response;
        document.getElementById("createproject").innerHTML = "created project with projectname: " + document.getElementById("projectName").value;
      };
    }

    function viewall() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', `http://${HOST}:${PORT}/view/allprojects`, true);
      xhr.responseType = 'json';
      xhr.send();

      xhr.onload = function() {
        let responseObj = xhr.response;
        document.getElementById("projectList").innerHTML = "";
        for(var property in responseObj.projects) {
          var node = document.createElement('li');
          node.appendChild(document.createTextNode("projectId" + property + ": " + responseObj.projects[property].projectName));
          document.getElementById("projectList").appendChild(node);
        } 
      };
    }

    function wipe() {
      var xhr = new XMLHttpRequest();
      xhr.open('DELETE', `http://${HOST}:${PORT}/clear`, true);
      xhr.responseType = 'json';
      xhr.send();

      xhr.onload = function() {
        if (document.getElementById("clear").innerHTML === "clear here!") {
          document.getElementById("clear").innerHTML = "done!";
        } else {
          document.getElementById("clear").innerHTML = "clear here!";
        }
        document.getElementById("messagelist").innerHTML = "messages appear here!";
        document.getElementById("createproject").innerHTML = "create one!";
        document.getElementById("projects").innerHTML = "projects appear here!";
      };
    }

    function sendMessage() {
      var xhr = new XMLHttpRequest();
      xhr.open('POST', `http://${HOST}:${PORT}/message/send`, true);
      let json = JSON.stringify({
        message: document.getElementById("message").value,
      });
      xhr.responseType = 'json';
      xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
      xhr.send(json);

      var xhr1 = new XMLHttpRequest();
      xhr1.open('GET', `http://${HOST}:${PORT}/view/messages`, true);
      xhr1.responseType = 'json';
      xhr1.send(json);

      xhr1.onload = function() {
        let responseObj = xhr1.response;
        if (responseObj.length !== 0) {
          document.getElementById("messagelist").innerHTML = "";
        } else {
          document.getElementById("messagelist").innerHTML = "no messages found :(";
        }
        for(var property in responseObj) {
          document.getElementById("messagelist").innerHTML += (parseInt(property) + 1) + ": " + responseObj[property] + " ";
        } 
      };
    }
    
    function createChecklist() {
      var xhr = new XMLHttpRequest();
      xhr.open('POST', `http://${HOST}:${PORT}/create/checklist`);
      let json = JSON.stringify({
        name: document.getElementById("checklistName").value,
        projectId: document.getElementById("projectId").value,
      });
      xhr.responseType = 'json';
      xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
      xhr.send(json);

      xhr.onload = function() {
        let responseObj = xhr.response;
      };
    }
  </script>

  <body>

  <header>
    <hgroup>
      <h1>Jayson's todos</h1>
      <h2>A new beginning</h2>
      <nav></nav>
    </hgroup>
  </header>    


  <h1>Description</h1>
  <p class="paragraph-style">This website allows you to keep track of all the tasks you may have.</p>

  <p>insert project name:</p>
  <input type = "text" id = "projectName"/><br>
  <button onclick="createProject()">Create Project</button>
  <p id="createproject">create one!</p>

  <button onclick="viewall()">View Projects</button>
  <p id="projects">projects appear here!</p>
  <ul id="projectList">
  </ul>

  <div>
    <label>Input ProjectId</label>
    <input type = "number" id = "projectId"/><br>
  </div>
  <div>
    <label>Input checklist name</label>
    <input type = "text" id = "checklistName"/><br>
  </div>
  <button onclick="createChecklist()">Create Checklist</button>

  <button onclick="wipe()">Clear!</button>
  <p id="clear">clear here!</p>

  <input type = "text" id = "message"/> <br>
  <button onclick="sendMessage()">send message</button>
  <p id="messagelist">messages appear here!</p>

  </body>

</html>